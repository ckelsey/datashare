{"version":3,"sources":["data-share.js"],"names":["app","service","$window","$localStorage","inIframe","window","self","top","e","data","callbacks","on","action","callback","push","trigger","hasOwnProperty","length","angular","forEach","resetCallbacks","windowListeners","getWindow","frame","win","isInIframe","parent","iframe","document","querySelector","contentWindow","getSelector","listen","addEventListener","post","message","origin","postMessage","unListen","removeListener","resetListenersBySelector","resetAllListeners","indices","i","windowListener","toString","removeEventListener","splice","selector","p","reset","getData","path","obj","split","postData","postAction","module"],"mappings":"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","file":"datashare.min.js","sourcesContent":["(function(app){\n\t'use strict';\n\n\tapp.service('dataShareService', function($window, $localStorage){\n\n\t\tfunction inIframe () {\n\t\t\ttry {\n\t\t\t\treturn window.self !== window.top;\n\t\t\t} catch (e) {\n\t\t\t\treturn true;\n\t\t\t}\n\t\t}\n\n\t\tfunction makeId(prefix, len){\n\t\t\tprefix = prefix === undefined ? 'data-share_' : prefix;\n\t\t\tlen = len || 28;\n\t\t\tvar text = \"\";\n\t\t\tvar possible = \"abcdefghijklmnopqrstuvwxyz0123456789\";\n\n\t\t\tfor( var i=0; i < len; i++ )\n\t\t\ttext += possible.charAt(Math.floor(Math.random() * possible.length));\n\n\t\t\treturn prefix + text;\n\t\t}\n\n\t\tif(!$localStorage.data){\n\t\t\t$localStorage.data = {};\n\t\t}\n\n\t\tvar self = {\n\n\t\t\tdata: $localStorage.data,\n\n\t\t\tcallbacks: {},\n\n\t\t\ton: function(action, callback) {\n\n\t\t\t\tif(!self.callbacks[action]) {\n\t\t\t\t\tself.callbacks[action] = [];\n\t\t\t\t}\n\n\t\t\t\tself.callbacks[action].push(callback);\n\t\t\t},\n\n\t\t\ttrigger: function(action, data){\n\t\t\t\tif(self.callbacks.hasOwnProperty(action) && self.callbacks[action] && self.callbacks[action].length){\n\t\t\t\t\tangular.forEach(self.callbacks[action], function(callback){\n\t\t\t\t\t\tcallback(data);\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t},\n\n\t\t\tresetCallbacks: function(action){\n\t\t\t\tif(action){\n\t\t\t\t\tdelete self.callbacks[action];\n\t\t\t\t}else{\n\t\t\t\t\tself.callbacks = {};\n\t\t\t\t}\n\t\t\t},\n\n\t\t\twindowListeners: {},\n\n\t\t\tgetWindow: function(frame){\n\t\t\t\tvar win, isInIframe = inIframe();\n\n\t\t\t\tif((frame === 'parent' && isInIframe) || (!frame && isInIframe)){\n\n\t\t\t\t\twin = $window.parent;\n\n\t\t\t\t}else if(frame === 'self'){\n\n\t\t\t\t\twin = $window;\n\n\t\t\t\t}else if(frame){\n\t\t\t\t\tvar iframe = document.querySelector(frame);\n\n\t\t\t\t\tif(iframe){\n\t\t\t\t\t\twin = iframe.contentWindow || iframe;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\treturn win;\n\t\t\t},\n\n\t\t\tgetSelector: function(frame){\n\t\t\t\tvar isInIframe = inIframe();\n\n\t\t\t\tif(!frame && isInIframe){\n\n\t\t\t\t\tframe = 'parent';\n\n\t\t\t\t}\n\n\t\t\t\treturn frame;\n\t\t\t},\n\n\t\t\tlisten: function(callback, frame){\n\t\t\t\tframe = self.getSelector(frame);\n\t\t\t\tvar win = self.getWindow(frame);\n\n\t\t\t\tif(win && frame && callback){\n\t\t\t\t\twin.addEventListener('message', callback);\n\n\t\t\t\t\tif(!self.windowListeners.hasOwnProperty(frame) || !self.windowListeners[frame]){\n\t\t\t\t\t\tself.windowListeners[frame] = [];\n\t\t\t\t\t}\n\n\t\t\t\t\tself.windowListeners[frame].push(callback);\n\t\t\t\t}\n\t\t\t},\n\n\t\t\tpost: function(message, frame, origin){\n\t\t\t\tvar win = self.getWindow(self.getSelector(frame));\n\n\t\t\t\tif(win){\n\t\t\t\t\twin.postMessage(message, (origin || '*'));\n\t\t\t\t}\n\t\t\t},\n\n\t\t\tunListen: function(callback, frame){\n\t\t\t\tframe = self.getSelector(frame);\n\t\t\t\tvar win = self.getWindow(frame);\n\n\t\t\t\tif(!callback && !frame){\n\t\t\t\t\tself.resetAllListeners();\n\t\t\t\t}else if(!callback){\n\t\t\t\t\tself.resetListenersBySelector(frame);\n\t\t\t\t}else if(frame && win && callback){\n\t\t\t\t\tself.removeListener(frame, win, callback);\n\t\t\t\t}\n\t\t\t},\n\n\t\t\tremoveListener: function(frame, win, callback){\n\t\t\t\tvar indices = [], i=0;\n\n\t\t\t\tfor(i=0; i<self.windowListeners[frame].length; i=i+1){\n\t\t\t\t\tvar windowListener = self.windowListeners[frame][i];\n\n\t\t\t\t\tif(callback.toString() === windowListener.toString()){\n\t\t\t\t\t\twin.removeEventListener('message', callback);\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\ti = indices.length;\n\n\t\t\t\twhile(i--){\n\t\t\t\t\tself.windowListeners[frame].splice(i, 1);\n\t\t\t\t}\n\t\t\t},\n\n\t\t\tresetListenersBySelector: function(selector){\n\t\t\t\tangular.forEach(self.windowListeners[selector], function(windowListener){\n\t\t\t\t\tif(p === 'sameWindow'){\n\t\t\t\t\t\t$window.removeEventListener('message', windowListener);\n\t\t\t\t\t}else{\n\t\t\t\t\t\t$window.parent.removeEventListener('message', windowListener);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t},\n\n\t\t\tresetAllListeners: function(){\n\t\t\t\tfor(var p in self.windowListeners){\n\t\t\t\t\tself.resetListenersBySelector(p);\n\t\t\t\t}\n\t\t\t},\n\n\t\t\treset: function(){\n\t\t\t\tself.callbacks = {};\n\t\t\t\tself.resetAllListeners();\n\t\t\t},\n\n\t\t\tgetData: function(path, frame){\n\t\t\t\tframe = self.getSelector(frame);\n\t\t\t\tvar win = self.getWindow(frame);\n\t\t\t\tvar obj = self.data;\n\n\t\t\t\tif(path && path !== ''){\n\t\t\t\t\tpath = path.split('.');\n\n\t\t\t\t\tfor(var p=0; p<path.length; p=p+1){\n\t\t\t\t\t\tobj = obj[path[p]];\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\treturn obj;\n\t\t\t},\n\n\t\t\tpostData: function(path, data, frame, postAction){\n\t\t\t\tframe = self.getSelector(frame);\n\t\t\t\tvar win = self.getWindow(frame);\n\t\t\t\tvar obj = self.data;\n\n\t\t\t\tif(path && path !== ''){\n\t\t\t\t\tpath = path.split('.');\n\n\t\t\t\t\tfor(var p=0; p<path.length; p=p+1){\n\n\t\t\t\t\t\tif(!obj.hasOwnProperty(path[p])){\n\t\t\t\t\t\t\tobj[path[p]] = {};\n\t\t\t\t\t\t}\n\t\t\t\t\t\tobj = obj[path[p]];\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tobj = data;\n\n\t\t\t\tif(postAction){\n\t\t\t\t\tself.post(postAction, frame);\n\t\t\t\t}\n\n\t\t\t\t// if(triggerAction){\n\t\t\t\t// \tself.trigger(triggerAction, obj);\n\t\t\t\t// }\n\t\t\t}\n\t\t};\n\n\t\treturn self;\n\t});\n})(angular.module('dataShare', [\n\t'ngStorage'\n]));\n"]}